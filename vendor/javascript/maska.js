// maska@3.2.0 downloaded from https://ga.jspm.io/npm:maska@3.2.0/dist/maska.mjs

var t=Object.defineProperty;var e=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var s=(t,s,n)=>e(t,typeof s!="symbol"?s+"":s,n);const n={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},a=(t,e,s)=>t.replaceAll(e,"").replace(s,".").replace("..",".").replace(/[^.\d]/g,""),r=(t,e,s)=>{var n;return new Intl.NumberFormat(((n=s.number)==null?void 0:n.locale)??"en",{minimumFractionDigits:t,maximumFractionDigits:e,roundingMode:"trunc"})},i=(t,e=!0,s)=>{var n,i,o,l;const u=((n=s.number)==null?void 0:n.unsigned)!==!0&&t.startsWith("-")?"-":"",p=((i=s.number)==null?void 0:i.fraction)??0;let h=r(0,p,s);const c=h.formatToParts(1000.12),m=((o=c.find((t=>t.type==="group")))==null?void 0:o.value)??" ",d=((l=c.find((t=>t.type==="decimal")))==null?void 0:l.value)??".",k=a(t,m,d);if(Number.isNaN(parseFloat(k)))return u;const g=k.split(".");if(g[1]!=null&&g[1].length>=1){const t=g[1].length<=p?g[1].length:p;h=r(t,p,s)}let v=h.format(parseFloat(k));return e?p>0&&k.endsWith(".")&&!k.slice(0,-1).includes(".")&&(v+=d):v=a(v,m,d),u+v},o=t=>JSON.parse(t.replaceAll("'",'"')),l=(t,e={})=>{const s={...e};t.dataset.maska!=null&&t.dataset.maska!==""&&(s.mask=p(t.dataset.maska)),t.dataset.maskaEager!=null&&(s.eager=u(t.dataset.maskaEager)),t.dataset.maskaReversed!=null&&(s.reversed=u(t.dataset.maskaReversed)),t.dataset.maskaTokensReplace!=null&&(s.tokensReplace=u(t.dataset.maskaTokensReplace)),t.dataset.maskaTokens!=null&&(s.tokens=h(t.dataset.maskaTokens));const n={};return t.dataset.maskaNumberLocale!=null&&(n.locale=t.dataset.maskaNumberLocale),t.dataset.maskaNumberFraction!=null&&(n.fraction=parseInt(t.dataset.maskaNumberFraction)),t.dataset.maskaNumberUnsigned!=null&&(n.unsigned=u(t.dataset.maskaNumberUnsigned)),(t.dataset.maskaNumber!=null||Object.values(n).length>0)&&(s.number=n),s},u=t=>t===""||!!JSON.parse(t),p=t=>t.startsWith("[")&&t.endsWith("]")?o(t):t,h=t=>{if(t.startsWith("{")&&t.endsWith("}"))return o(t);const e={};return t.split("|").forEach((t=>{const s=t.split(":");e[s[0]]={pattern:c()?new RegExp(s[1],"u"):new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}})),e},c=()=>{try{return new RegExp("\\p{L}","u"),!0}catch{return!1}};class O{constructor(t={}){s(this,"opts",{});s(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...n,...e.tokens};for(const t of Object.values(e.tokens))typeof t.pattern=="string"&&(t.pattern=c()?new RegExp(t.pattern,"u"):new RegExp(t.pattern))}else e.tokens=n;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort(((t,e)=>t.length-e.length)):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(String(t),this.findMask(String(t)))}unmasked(t){return this.process(String(t),this.findMask(String(t)),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(String(t));if(this.opts.mask==null||e==null)return!1;const s=this.process(String(t),e).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:s>=e.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find((e=>this.process(t,e,!1).length>=s.length))??""}escapeMask(t){const e=[],s=[];return t.split("").forEach(((n,a)=>{n==="!"&&t[a-1]!=="!"?s.push(a-s.length):e.push(n)})),{mask:e.join(""),escaped:s}}process(t,e,s=!0){if(this.opts.number!=null)return i(t,s,this.opts);if(e==null)return t;const n=`v=${t},mr=${e},m=${s?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:a,escaped:r}=this.escapeMask(e),o=[],l=this.opts.tokens!=null?this.opts.tokens:{},u=this.isReversed()?-1:1,p=this.isReversed()?"unshift":"push",h=this.isReversed()?0:a.length-1,c=this.isReversed()?()=>g>-1&&v>-1:()=>g<a.length&&v<t.length,m=t=>!this.isReversed()&&t<=h||this.isReversed()&&t>=h;let d,k=-1,g=this.isReversed()?a.length-1:0,v=this.isReversed()?t.length-1:0,f=!1;for(;c();){const e=a.charAt(g),n=l[e],i=(n==null?void 0:n.transform)!=null?n.transform(t.charAt(v)):t.charAt(v);if(r.includes(g)||n==null?(s&&!this.isEager()&&o[p](e),i!==e||this.isEager()?d=e:v+=u,this.isEager()||(g+=u)):(i.match(n.pattern)!=null?(o[p](i),n.repeated?(k===-1?k=g:g===h&&g!==k&&(g=k-u),h===k&&(g-=u)):n.multiple&&(f=!0,g-=u),g+=u):n.multiple?f&&(g+=u,v-=u,f=!1):i===d?d=void 0:n.optional&&(g+=u,v-=u),v+=u),this.isEager())for(;m(g)&&(l[a.charAt(g)]==null||r.includes(g));){if(s){if(o[p](a.charAt(g)),t.charAt(v)===a.charAt(g)){g+=u,v+=u;continue}}else a.charAt(g)===t.charAt(v)&&(v+=u);g+=u}}return this.memo.set(n,o.join("")),this.memo.get(n)}}class V{constructor(t,e={}){s(this,"items",new Map);s(this,"eventAbortController");s(this,"onInput",(t=>{if(t instanceof CustomEvent&&t.type==="input"&&!t.isTrusted&&!t.bubbles)return;const e=t.target,s=this.items.get(e);if(s===void 0)return;const n="inputType"in t&&t.inputType.startsWith("delete"),a=s.isEager(),r=n&&a&&s.unmasked(e.value)===""?"":e.value;this.fixCursor(e,n,(()=>this.setValue(e,r)))}));this.options=e,this.eventAbortController=new AbortController,this.init(this.getInputs(t))}update(t={}){this.options={...t},this.init(Array.from(this.items.keys()))}updateValue(t){var e;t.value!==""&&t.value!==((e=this.processInput(t))==null?void 0:e.masked)&&this.setValue(t,t.value)}destroy(){this.eventAbortController.abort(),this.items.clear()}init(t){const e=this.getOptions(this.options);for(const s of t){if(!this.items.has(s)){const{signal:t}=this.eventAbortController;s.addEventListener("input",this.onInput,{capture:!0,signal:t})}const t=new O(l(s,e));this.items.set(s,t),queueMicrotask((()=>this.updateValue(s))),s.selectionStart===null&&t.isEager()&&console.warn("Maska: input of `%s` type is not supported",s.type)}}getInputs(t){return typeof t=="string"?Array.from(document.querySelectorAll(t)):"length"in t?Array.from(t):[t]}getOptions(t){const{onMaska:e,preProcess:s,postProcess:n,...a}=t;return a}fixCursor(t,e,s){var n,a;const r=t.selectionStart,i=t.value;if(s(),r===null||r===i.length&&!e)return;const o=t.value,l=i.slice(0,r),u=o.slice(0,r),p=(n=this.processInput(t,l))==null?void 0:n.unmasked,h=(a=this.processInput(t,u))==null?void 0:a.unmasked;if(p===void 0||h===void 0)return;let c=r;l!==u&&(c+=e?o.length-i.length:p.length-h.length),t.setSelectionRange(c,c)}setValue(t,e){const s=this.processInput(t,e);s!==void 0&&(t.value=s.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach((t=>t(s))):this.options.onMaska(s)),t.dispatchEvent(new CustomEvent("maska",{detail:s})),t.dispatchEvent(new CustomEvent("input",{detail:s.masked})))}processInput(t,e){const s=this.items.get(t);if(s===void 0)return;let n=e??t.value;this.options.preProcess!=null&&(n=this.options.preProcess(n));let a=s.masked(n);return this.options.postProcess!=null&&(a=this.options.postProcess(a)),{masked:a,unmasked:s.unmasked(n),completed:s.completed(n)}}}export{O as Mask,V as MaskInput,n as tokens};

